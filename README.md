# ğŸš€ WarpMesh

<img width="100%" src="https://raw.githubusercontent.com/chunyang-w/chunyang-w.github.io/pic/202306231902481.webp"/>

(Image source: [Star Trek: Official Site](https://intl.startrek.com/article/warp-drive-a-reality-could-be-soon))

## ğŸ” About this project:

In the famous TV series Star Trek, the starship Enterprise is able to travel faster than light by warping space-time. In this project, we 'warp' the underlying mesh of a discretised PDE problem to win some computational time. The node of the mesh is moved to the ideal position guided by a GNN, which is supposed to be faster than numerical solvers.


The latest test status:

[![WarpMesh](https://github.com/chunyang-w/WarpMesh/actions/workflows/test_warpmesh.yml/badge.svg)](https://github.com/chunyang-w/WarpMesh/actions/workflows/test_warpmesh.yml)


## ğŸ› ï¸ Installation

### The easy way:

Just navigate to **project root** folder, open terminaland execute the `install/install.sh` shell script:

``` shell
sh ./install/install.sh
```

This will install [firedrake](https://www.firedrakeproject.org/download.html) and [movement](https://github.com/pyroteus/movement) under `install` folder.


### The hard way (in case the easy way did not goes well or you want to challenge yourself):

1. The mesh generation relies on firedrake, which is a python package. To install firedrake, please follow the instructions on [firedrakeproject.org](https://www.firedrakeproject.org/download.html).

2. The movement of the mesh is implemented by `pyroteus/movement`, install it in the firedrake venv. To install, run `pip install -e .` in the `pyroteus/movement` directory. Here is a link to that repo: [pyroteus/movement](https://github.com/pyroteus/movement).

3. Use the venv provided by firedrake to install the dependencies of this project. The venv is located at `~/firedrakevenv/bin/activate`. To activate the venv, run `source ~/firedrakevenv/bin/activate`. Then run `pip install -r requirements.txt` to install the dependencies.

4. Run `pip install -e .` in the root directory of this project to install the package.


## ğŸ’¿ Dataset generation

In case you do not wish to generate the dataset by yourself, here is a pre-generated dataset on google drive: [link](https://drive.google.com/drive/folders/1suY-WyECV_-UlWds8tR1gMlD7oxDOlqx?usp=sharing). The naming convention of the file is 'z=<0,1>_n_dist={number_of_distribution_used}_max_dist={maximum_distribution_used}_<{number_of_grid_in_x_direction}_{number_of_grid_in_y_direction}>_n={number_of_samples}_{data_set_type}'

if `n_dist = None`, then the number of gaussian distribution used will be randomly choosed from 1 to `max_dist`, otherwise, `n_dist` will be used to generate a fixed number of gaussian distribution version dataset.

the {data_set_type} will be either 'smpl' or 'cmplx', indicating whether the dataset is isotropic or anisotropic.

after download, you should put the downloaded folder `helmholtz` under `data/dataset` folder.

### Generate the dataset by yourself

```{shell}
python script/make_dataset.sh
```
This command will make datasets of sizes from 15 to 35, both isotropic and anisotropic datasets. The datasets will be saved in `data/dataset` folder.

User can modify the variables
```
n_dist_start=1
n_dist_end=10
n_grid_start=15
n_grid_end=35
```

defined in `script/make_dataset.sh` to generate datasets of different sizes.

The number of samples in the dataset can be changed by modifying the variable `n_sample` in `script/build_helmholtz_dataset`.

## ğŸš€ Train the model

A training notebook is provided: `script/train_warpmesh.ipynb`. Further training details can be found in the notebook.

Here is also a link to pretrained models: [link] (https://drive.google.com/drive/folders/1P_JMpU1qmLdmbGTz8fL5VO-lEBoP3_2n?usp=sharing)

## ğŸ“Š Evaluate the model

There are a set of visulisation scipypt under `script/` folder. The script can be used to evaluate the model performance.

## ğŸ“– Documentation
The documentation is generated by sphinx. To build the documentation,under the `docs` folder.


## ğŸ§© Project Layout

```
â”œâ”€â”€ warpmesh (impelementation of the project)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ generator (dataset generator)
â”‚   â”œâ”€â”€ processor (data processor)
â”‚   â”œâ”€â”€ helper (helper functions)
â”‚   â”œâ”€â”€ loader (customized dataset & dataloader)
â”‚   â”œâ”€â”€ model (MRN and M2N model implementation)
â”‚   â””â”€â”€ test (simpe tests for model)
â”œâ”€â”€ install (installation scripts for dependencies)
â”‚   â”œâ”€â”€ firedrake
â”‚   â”œâ”€â”€ install.sh
â”‚   â””â”€â”€ movement
â”œâ”€â”€ data (place gnereated dataset here)
â”‚   â”œâ”€â”€ dataset
â”‚   â””â”€â”€ output
â”œâ”€â”€ docs (documentation)
â”‚   â”œâ”€â”€ conf.py
â”‚   â””â”€â”€ index.rst
â”œâ”€â”€ script (Utility scripts)
â”‚   â”œâ”€â”€ make_dataset.sh (make datasets fo different sizes)
â”‚   â”œâ”€â”€ build_helmholtz_dataset.py (build helmholtz dataset)
â”‚   â”œâ”€â”€ compare.py (compare the performance of different models)
â”‚   â”œâ”€â”€ evaluate.py 
â”‚   â”œâ”€â”€ gradual_change.py
â”‚   â”œâ”€â”€ plot.py
â”‚   â”œâ”€â”€ train_model.py
â”‚   â””â”€â”€ ...
â”œâ”€â”€ tests
â”‚   â”œâ”€â”€ play_conv_feat.py
â”‚   â”œâ”€â”€ play_dataset.py
â”‚   â”œâ”€â”€ test_import.py
â”‚   â””â”€â”€ ...
â”œâ”€â”€ setup.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ README.md
```

## ğŸ––ğŸ¼ At last ...

Live long and prosper!  
